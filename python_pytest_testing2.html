<!DOCTYPE html>
<html lang="cn">
<head>
        <meta charset="utf-8" />
        <title>自动化测试框架工具pytest教程2-测试函数</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">python自动化测试人工智能 </a></h1>
                <nav><ul>
                    <li><a href="/category/ce-shi.html">测试</a></li>
                    <li class="active"><a href="/category/ce-shi-kuang-jia.html">测试框架</a></li>
                    <li><a href="/category/common.html">common</a></li>
                    <li><a href="/category/ji-qi-xue-xi.html">机器学习</a></li>
                    <li><a href="/category/linux.html">linux</a></li>
                    <li><a href="/category/python.html">python</a></li>
                    <li><a href="/category/shu-ju-fen-xi.html">数据分析</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/python_pytest_testing2.html" rel="bookmark"
           title="Permalink to 自动化测试框架工具pytest教程2-测试函数">自动化测试框架工具pytest教程2-测试函数</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-05-16T10:20:00+08:00">
                Published: 三 16 五月 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/andrew.html">andrew</a>
        </address>
<p>In <a href="/category/ce-shi-kuang-jia.html">测试框架</a>.</p>

</footer><!-- /.post-info -->      <p>第2章 测试函数</p>
<h3 id="tasks">测试Tasks程序</h3>
<p>被测程序Tasks的结构如下</p>
<div class="highlight"><pre><span></span>tasks_proj/
├── CHANGELOG.rst
├── LICENSE
├── MANIFEST.in
├── README.rst
├── setup.py
├── src
│ └── tasks
│ ├── __init__.py
│ ├── api.py
│ ├── cli.py
│ ├── config.py
│ ├── tasksdb_pymongo.py
│ └── tasksdb_tinydb.py
└── tests
├── conftest.py
├── pytest.ini
├── func
│ ├── __init__.py
│ ├── test_add.py
│ └── ...
└── unit
├── __init__.py
├── test_task.py
└── ...
</pre></div>


<p>安装:</p>
<div class="highlight"><pre><span></span><span class="c1"># python3 setup.py install </span>
running install
Checking .pth file support in /usr/local/lib/python3.5/dist-packages/
/usr/bin/python3 -E -c pass
TEST PASSED: /usr/local/lib/python3.5/dist-packages/ appears to support .pth files
running bdist_egg
running egg_info
creating src/tasks.egg-info
writing src/tasks.egg-info/PKG-INFO
writing dependency_links to src/tasks.egg-info/dependency_links.txt
writing top-level names to src/tasks.egg-info/top_level.txt
writing requirements to src/tasks.egg-info/requires.txt
writing entry points to src/tasks.egg-info/entry_points.txt
writing manifest file <span class="s1">&#39;src/tasks.egg-info/SOURCES.txt&#39;</span>
reading manifest file <span class="s1">&#39;src/tasks.egg-info/SOURCES.txt&#39;</span>
reading manifest template <span class="s1">&#39;MANIFEST.in&#39;</span>
writing manifest file <span class="s1">&#39;src/tasks.egg-info/SOURCES.txt&#39;</span>
installing library code to build/bdist.linux-x86_64/egg
running install_lib
running build_py
creating build
creating build/lib
creating build/lib/tasks
copying src/tasks/api.py -&gt; build/lib/tasks
copying src/tasks/tasksdb_pymongo.py -&gt; build/lib/tasks
copying src/tasks/tasksdb_tinydb.py -&gt; build/lib/tasks
copying src/tasks/config.py -&gt; build/lib/tasks
copying src/tasks/__init__.py -&gt; build/lib/tasks
copying src/tasks/cli.py -&gt; build/lib/tasks
creating build/bdist.linux-x86_64
creating build/bdist.linux-x86_64/egg
creating build/bdist.linux-x86_64/egg/tasks
copying build/lib/tasks/api.py -&gt; build/bdist.linux-x86_64/egg/tasks
copying build/lib/tasks/tasksdb_pymongo.py -&gt; build/bdist.linux-x86_64/egg/tasks
copying build/lib/tasks/tasksdb_tinydb.py -&gt; build/bdist.linux-x86_64/egg/tasks
copying build/lib/tasks/config.py -&gt; build/bdist.linux-x86_64/egg/tasks
copying build/lib/tasks/__init__.py -&gt; build/bdist.linux-x86_64/egg/tasks
copying build/lib/tasks/cli.py -&gt; build/bdist.linux-x86_64/egg/tasks
byte-compiling build/bdist.linux-x86_64/egg/tasks/api.py to api.cpython-35.pyc
byte-compiling build/bdist.linux-x86_64/egg/tasks/tasksdb_pymongo.py to tasksdb_pymongo.cpython-35.pyc
byte-compiling build/bdist.linux-x86_64/egg/tasks/tasksdb_tinydb.py to tasksdb_tinydb.cpython-35.pyc
byte-compiling build/bdist.linux-x86_64/egg/tasks/config.py to config.cpython-35.pyc
byte-compiling build/bdist.linux-x86_64/egg/tasks/__init__.py to __init__.cpython-35.pyc
byte-compiling build/bdist.linux-x86_64/egg/tasks/cli.py to cli.cpython-35.pyc
creating build/bdist.linux-x86_64/egg/EGG-INFO
copying src/tasks.egg-info/PKG-INFO -&gt; build/bdist.linux-x86_64/egg/EGG-INFO
copying src/tasks.egg-info/SOURCES.txt -&gt; build/bdist.linux-x86_64/egg/EGG-INFO
copying src/tasks.egg-info/dependency_links.txt -&gt; build/bdist.linux-x86_64/egg/EGG-INFO
copying src/tasks.egg-info/entry_points.txt -&gt; build/bdist.linux-x86_64/egg/EGG-INFO
copying src/tasks.egg-info/requires.txt -&gt; build/bdist.linux-x86_64/egg/EGG-INFO
copying src/tasks.egg-info/top_level.txt -&gt; build/bdist.linux-x86_64/egg/EGG-INFO
zip_safe flag not set<span class="p">;</span> analyzing archive contents...
creating dist
creating <span class="s1">&#39;dist/tasks-0.1.0-py3.5.egg&#39;</span> and adding <span class="s1">&#39;build/bdist.linux-x86_64/egg&#39;</span> to it
removing <span class="s1">&#39;build/bdist.linux-x86_64/egg&#39;</span> <span class="o">(</span>and everything under it<span class="o">)</span>
Processing tasks-0.1.0-py3.5.egg
Copying tasks-0.1.0-py3.5.egg to /usr/local/lib/python3.5/dist-packages
Adding tasks <span class="m">0</span>.1.0 to easy-install.pth file
Installing tasks script to /usr/local/bin

Installed /usr/local/lib/python3.5/dist-packages/tasks-0.1.0-py3.5.egg
Processing dependencies <span class="k">for</span> <span class="nv">tasks</span><span class="o">==</span><span class="m">0</span>.1.0
Searching <span class="k">for</span> tinydb
Reading https://pypi.python.org/simple/tinydb/
Best match: tinydb <span class="m">3</span>.9.0.post1
Downloading https://files.pythonhosted.org/packages/82/f2/c26a5c4b8486349dacc8abba33c495b77a0b67052b5c79c5d5c90da49b95/tinydb-3.9.0.post1.tar.gz#sha256<span class="o">=</span>88793016ba94267e3606372e1564d4e797eae855acd5a48352011bfdcf8ee7ad
Processing tinydb-3.9.0.post1.tar.gz
Writing /tmp/easy_install-_cvtvm1f/tinydb-3.9.0.post1/setup.cfg
Running tinydb-3.9.0.post1/setup.py -q bdist_egg --dist-dir /tmp/easy_install-_cvtvm1f/tinydb-3.9.0.post1/egg-dist-tmp-xpn6fitk
/usr/lib/python3.5/distutils/dist.py:261: UserWarning: Unknown distribution option: <span class="s1">&#39;python_requires&#39;</span>
  warnings.warn<span class="o">(</span>msg<span class="o">)</span>
zip_safe flag not set<span class="p">;</span> analyzing archive contents...

Installed /tmp/easy_install-_cvtvm1f/tinydb-3.9.0.post1/.eggs/pytest_runner-4.2-py3.5.egg
/usr/lib/python3.5/distutils/dist.py:261: UserWarning: Unknown distribution option: <span class="s1">&#39;project_urls&#39;</span>
  warnings.warn<span class="o">(</span>msg<span class="o">)</span>
Moving tinydb-3.9.0.post1-py3.5.egg to /usr/local/lib/python3.5/dist-packages
Adding tinydb <span class="m">3</span>.9.0.post1 to easy-install.pth file

Installed /usr/local/lib/python3.5/dist-packages/tinydb-3.9.0.post1-py3.5.egg
Searching <span class="k">for</span> <span class="nv">six</span><span class="o">==</span><span class="m">1</span>.10.0
Best match: six <span class="m">1</span>.10.0
Adding six <span class="m">1</span>.10.0 to easy-install.pth file

Using /usr/lib/python3/dist-packages
Searching <span class="k">for</span> <span class="nv">click</span><span class="o">==</span><span class="m">6</span>.7
Best match: click <span class="m">6</span>.7
Adding click <span class="m">6</span>.7 to easy-install.pth file

Using /usr/local/lib/python3.5/dist-packages
Finished processing dependencies <span class="k">for</span> <span class="nv">tasks</span><span class="o">==</span><span class="m">0</span>.1.0
</pre></div>


<p>其他安装方式： 在tasks_proj执行：“pip install . ” 或者 “pip install -e .”， 或者在上级目录执行“pip install -e tasks_proj”。 -e 为editor，可以编辑源码。</p>
<p>被测程序演示：</p>
<div class="highlight"><pre><span></span>$ tasks add <span class="s2">&quot;reading pytest!&quot;</span> --owner Andrew
$ tasks add <span class="s2">&quot;do something else&quot;</span>
$ tasks list
  ID      owner  <span class="k">done</span> summary
  --      -----  ---- -------
   <span class="m">1</span>     Andrew False reading pytest!
   <span class="m">2</span>            False <span class="k">do</span> something <span class="k">else</span>
$ tasks update <span class="m">2</span> --owner Brian
$ tasks list
  ID      owner  <span class="k">done</span> summary
  --      -----  ---- -------
   <span class="m">1</span>     Andrew False reading pytest!
   <span class="m">2</span>      Brian False <span class="k">do</span> something <span class="k">else</span>
$ tasks update <span class="m">1</span> --done True
$ tasks list
  ID      owner  <span class="k">done</span> summary
  --      -----  ---- -------
   <span class="m">1</span>     Andrew  True reading pytest!
   <span class="m">2</span>      Brian False <span class="k">do</span> something <span class="k">else</span>
$ tasks delete <span class="m">1</span>
$ tasks list
  ID      owner  <span class="k">done</span> summary
  --      -----  ---- -------
   <span class="m">2</span>      Brian False <span class="k">do</span> something <span class="k">else</span>
</pre></div>


<p>把前面的单元测试进行汇总：</p>
<p>/ch2/tasks_proj/tests/unit/test_task.py</p>
<div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Test the Task data type.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">tasks</span> <span class="kn">import</span> <span class="n">Task</span>


<span class="k">def</span> <span class="nf">test_asdict</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;_asdict() should return a dictionary.&quot;&quot;&quot;</span>
    <span class="n">t_task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;do something&#39;</span><span class="p">,</span> <span class="s1">&#39;okken&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
    <span class="n">t_dict</span> <span class="o">=</span> <span class="n">t_task</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;summary&#39;</span><span class="p">:</span> <span class="s1">&#39;do something&#39;</span><span class="p">,</span>
                <span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="s1">&#39;okken&#39;</span><span class="p">,</span>
                <span class="s1">&#39;done&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">21</span><span class="p">}</span>
    <span class="k">assert</span> <span class="n">t_dict</span> <span class="o">==</span> <span class="n">expected</span>


<span class="k">def</span> <span class="nf">test_replace</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;replace() should change passed in fields.&quot;&quot;&quot;</span>
    <span class="n">t_before</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;finish book&#39;</span><span class="p">,</span> <span class="s1">&#39;brian&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">t_after</span> <span class="o">=</span> <span class="n">t_before</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">done</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">t_expected</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;finish book&#39;</span><span class="p">,</span> <span class="s1">&#39;brian&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">t_after</span> <span class="o">==</span> <span class="n">t_expected</span>


<span class="k">def</span> <span class="nf">test_defaults</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Using no parameters should invoke defaults.&quot;&quot;&quot;</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">Task</span><span class="p">()</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">t1</span> <span class="o">==</span> <span class="n">t2</span>


<span class="k">def</span> <span class="nf">test_member_access</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Check .field functionality of namedtuple.&quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;buy milk&#39;</span><span class="p">,</span> <span class="s1">&#39;brian&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">summary</span> <span class="o">==</span> <span class="s1">&#39;buy milk&#39;</span>
    <span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">owner</span> <span class="o">==</span> <span class="s1">&#39;brian&#39;</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">done</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>


<p>执行</p>
<div class="highlight"><pre><span></span>andrew@andrew-PowerEdge-T630:~/code/china-testing/python3_libraries/pytest_testing/ch2/tasks_proj/tests/unit$ pytest test_task.py 
<span class="o">===========================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">===========================================</span>
platform linux -- Python <span class="m">3</span>.5.2, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /home/andrew/code/china-testing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
collected <span class="m">4</span> items                                                                                         

test_task.py ....                                                                                   <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">========================================</span> <span class="m">4</span> passed in <span class="m">0</span>.02 <span class="nv">seconds</span> <span class="o">=========================================</span>
</pre></div>


<h3 id="_1">断言</h3>
<p>test_task_fail.py </p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tasks</span> <span class="kn">import</span> <span class="n">Task</span>


<span class="k">def</span> <span class="nf">test_task_equality</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Different tasks should not be equal.&quot;&quot;&quot;</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;sit there&#39;</span><span class="p">,</span> <span class="s1">&#39;brian&#39;</span><span class="p">)</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;do something&#39;</span><span class="p">,</span> <span class="s1">&#39;okken&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">t1</span> <span class="o">==</span> <span class="n">t2</span>


<span class="k">def</span> <span class="nf">test_dict_equality</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Different tasks compared as dicts should not be equal.&quot;&quot;&quot;</span>
    <span class="n">t1_dict</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;make sandwich&#39;</span><span class="p">,</span> <span class="s1">&#39;okken&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>
    <span class="n">t2_dict</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;make sandwich&#39;</span><span class="p">,</span> <span class="s1">&#39;okkem&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">t1_dict</span> <span class="o">==</span> <span class="n">t2_dict</span>
</pre></div>


<p>执行：</p>
<div class="highlight"><pre><span></span>~/code/china-testing/python3_libraries/pytest_testing/ch2/tasks_proj/tests/unit$ pytest test_task_fail.py 
<span class="o">===========================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">===========================================</span>
platform linux -- Python <span class="m">3</span>.5.2, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /home/andrew/code/china-testing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
collected <span class="m">2</span> items                                                                                         

test_task_fail.py FF                                                                                <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">================================================</span> <span class="nv">FAILURES</span> <span class="o">=================================================</span>
___________________________________________ test_task_equality ____________________________________________

    def test_task_equality<span class="o">()</span>:
        <span class="s2">&quot;&quot;&quot;Different tasks should not be equal.&quot;&quot;&quot;</span>
        <span class="nv">t1</span> <span class="o">=</span> Task<span class="o">(</span><span class="s1">&#39;sit there&#39;</span>, <span class="s1">&#39;brian&#39;</span><span class="o">)</span>
        <span class="nv">t2</span> <span class="o">=</span> Task<span class="o">(</span><span class="s1">&#39;do something&#39;</span>, <span class="s1">&#39;okken&#39;</span><span class="o">)</span>
&gt;       assert <span class="nv">t1</span> <span class="o">==</span> t2
E       AssertionError: assert Task<span class="o">(</span><span class="nv">summary</span><span class="o">=</span>...alse, <span class="nv">id</span><span class="o">=</span>None<span class="o">)</span> <span class="o">==</span> Task<span class="o">(</span><span class="nv">summary</span><span class="o">=</span><span class="s1">&#39;...alse, id=None)</span>
<span class="s1">E         At index 0 diff: &#39;</span>sit there<span class="s1">&#39; != &#39;</span><span class="k">do</span> something<span class="s1">&#39;</span>
<span class="s1">E         Use -v to get the full diff</span>

<span class="s1">test_task_fail.py:9: AssertionError</span>
<span class="s1">___________________________________________ test_dict_equality ____________________________________________</span>

<span class="s1">    def test_dict_equality():</span>
<span class="s1">        &quot;&quot;&quot;Different tasks compared as dicts should not be equal.&quot;&quot;&quot;</span>
<span class="s1">        t1_dict = Task(&#39;</span>make sandwich<span class="s1">&#39;, &#39;</span>okken<span class="s1">&#39;)._asdict()</span>
<span class="s1">        t2_dict = Task(&#39;</span>make sandwich<span class="s1">&#39;, &#39;</span>okkem<span class="s1">&#39;)._asdict()</span>
<span class="s1">&gt;       assert t1_dict == t2_dict</span>
<span class="s1">E       AssertionError: assert OrderedDict([...(&#39;</span>id<span class="s1">&#39;, None)]) == OrderedDict([(...(&#39;</span>id<span class="s1">&#39;, None)])</span>
<span class="s1">E         Omitting 3 identical items, use -vv to show</span>
<span class="s1">E         Differing items:</span>
<span class="s1">E         {&#39;</span>owner<span class="s1">&#39;: &#39;</span>okken<span class="s1">&#39;} != {&#39;</span>owner<span class="s1">&#39;: &#39;</span>okkem<span class="err">&#39;</span><span class="o">}</span>
E         Use -v to get the full diff

test_task_fail.py:16: <span class="nv">AssertionError</span>
<span class="o">========================================</span> <span class="m">2</span> failed in <span class="m">0</span>.04 <span class="nv">seconds</span> <span class="o">=========================================</span>
</pre></div>


<p><a href="https://docs.pytest.org/en/latest/example/reportingdemo.html">更多断言实例</a></p>
<h3 id="_2">预期异常</h3>
<p>tasks/api.py的函数如下：</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">task</span><span class="p">):</span> <span class="c1"># type: (Task) -&gt; int</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">task_id</span><span class="p">):</span> <span class="c1"># type: (int) -&gt; Task</span>
<span class="k">def</span> <span class="nf">list_tasks</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span> <span class="c1"># type: (str|None) -&gt; list of Task</span>
<span class="k">def</span> <span class="nf">count</span><span class="p">():</span> <span class="c1"># type: (None) -&gt; int</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span> <span class="c1"># type: (int, Task) -&gt; None</span>
<span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="n">task_id</span><span class="p">):</span> <span class="c1"># type: (int) -&gt; None</span>
<span class="k">def</span> <span class="nf">delete_all</span><span class="p">():</span> <span class="c1"># type: () -&gt; None</span>
<span class="k">def</span> <span class="nf">unique_id</span><span class="p">():</span> <span class="c1"># type: () -&gt; int</span>
<span class="k">def</span> <span class="nf">start_tasks_db</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="n">db_type</span><span class="p">):</span> <span class="c1"># type: (str, str) -&gt; None</span>
<span class="k">def</span> <span class="nf">stop_tasks_db</span><span class="p">():</span> <span class="c1"># type: () -&gt; None</span>
</pre></div>


<p>test_api_exceptions.py</p>
<div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Test for expected exceptions from using the API wrong.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">tasks</span>


<span class="k">def</span> <span class="nf">test_add_raises</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;add() should raise an exception with wrong type param.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;not a Task object&#39;</span><span class="p">)</span>


<span class="nd">@pytest.mark.smoke</span>
<span class="k">def</span> <span class="nf">test_list_raises</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;list() should raise an exception with wrong type param.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">list_tasks</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>


<span class="nd">@pytest.mark.get</span>
<span class="nd">@pytest.mark.smoke</span>
<span class="k">def</span> <span class="nf">test_get_raises</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;get() should raise an exception with wrong type param.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TestUpdate</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Test expected exceptions with tasks.update().&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_bad_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A non-int id should raise an excption.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task_id</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dict instead&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                         <span class="n">task</span><span class="o">=</span><span class="n">tasks</span><span class="o">.</span><span class="n">Task</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_bad_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A non-Task task should raise an excption.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="s1">&#39;not a task&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_delete_raises</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;delete() should raise an exception with wrong type param.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">task_id</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">test_start_tasks_db_raises</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Make sure unsupported db raises an exception.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">excinfo</span><span class="p">:</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">start_tasks_db</span><span class="p">(</span><span class="s1">&#39;some/great/path&#39;</span><span class="p">,</span> <span class="s1">&#39;mysql&#39;</span><span class="p">)</span>
    <span class="n">exception_msg</span> <span class="o">=</span> <span class="n">excinfo</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">exception_msg</span> <span class="o">==</span> <span class="s2">&quot;db_type must be a &#39;tiny&#39; or &#39;mongo&#39;&quot;</span>
</pre></div>


<h3 id="_3">标记测试函数</h3>
<p>基于标签实现，参见上面代码。</p>
<div class="highlight"><pre><span></span>andrew@andrew-PowerEdge-T630:~/code/china-testing/python3_libraries/pytest_testing/ch2/tasks_proj/tests/func$  pytest test_api_exceptions.py 
<span class="o">===========================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">===========================================</span>
platform linux -- Python <span class="m">3</span>.5.2, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /home/andrew/code/china-testing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
collected <span class="m">7</span> items                                                                                         

test_api_exceptions.py .......                                                                      <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">========================================</span> <span class="m">7</span> passed in <span class="m">0</span>.03 <span class="nv">seconds</span> <span class="o">=========================================</span>
andrew@andrew-PowerEdge-T630:~/code/china-testing/python3_libraries/pytest_testing/ch2/tasks_proj/tests/func$ pytest test_api_exceptions.py  -v -m <span class="s2">&quot;smoke&quot;</span>
<span class="o">===========================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">===========================================</span>
platform linux -- Python <span class="m">3</span>.5.2, pytest-3.5.1, py-1.5.3, pluggy-0.6.0 -- /usr/bin/python3
cachedir: ../.pytest_cache
rootdir: /home/andrew/code/china-testing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
collected <span class="m">7</span> items / <span class="m">5</span> deselected                                                                          

test_api_exceptions.py::test_list_raises PASSED                                                     <span class="o">[</span> <span class="m">50</span>%<span class="o">]</span>
test_api_exceptions.py::test_get_raises PASSED                                                      <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">=================================</span> <span class="m">2</span> passed, <span class="m">5</span> deselected in <span class="m">0</span>.02 <span class="nv">seconds</span> <span class="o">==================================</span>
andrew@andrew-PowerEdge-T630:~/code/china-testing/python3_libraries/pytest_testing/ch2/tasks_proj/tests/func$ pytest test_api_exceptions.py  -v -m <span class="s2">&quot;smoke and get&quot;</span>
<span class="o">===========================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">===========================================</span>
platform linux -- Python <span class="m">3</span>.5.2, pytest-3.5.1, py-1.5.3, pluggy-0.6.0 -- /usr/bin/python3
cachedir: ../.pytest_cache
rootdir: /home/andrew/code/china-testing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
collected <span class="m">7</span> items / <span class="m">6</span> deselected                                                                          

test_api_exceptions.py::test_get_raises PASSED                                                      <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">=================================</span> <span class="m">1</span> passed, <span class="m">6</span> deselected in <span class="m">0</span>.01 <span class="nv">seconds</span> <span class="o">==================================</span>
andrew@andrew-PowerEdge-T630:~/code/china-testing/python3_libraries/pytest_testing/ch2/tasks_proj/tests/func$ pytest test_api_exceptions.py  -v -m <span class="s2">&quot;smoke and not get&quot;</span>
<span class="o">===========================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">===========================================</span>
platform linux -- Python <span class="m">3</span>.5.2, pytest-3.5.1, py-1.5.3, pluggy-0.6.0 -- /usr/bin/python3
cachedir: ../.pytest_cache
rootdir: /home/andrew/code/china-testing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
collected <span class="m">7</span> items / <span class="m">6</span> deselected                                                                          

test_api_exceptions.py::test_list_raises PASSED                                                     <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">=================================</span> <span class="m">1</span> passed, <span class="m">6</span> deselected in <span class="m">0</span>.01 <span class="nv">seconds</span> <span class="o">==================================</span>
andrew@andrew-PowerEdge-T630:~/code/china-testing/python3_libraries/pytest_testing/ch2/tasks_proj/tests/func$ 

$ pytest -v -m <span class="nv">smoke</span>
<span class="o">========================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=========================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0 -- /usr/local/anaconda3/bin/python
cachedir: ../.pytest_cache
metadata: <span class="o">{</span><span class="s1">&#39;Python&#39;</span>: <span class="s1">&#39;3.6.5&#39;</span>, <span class="s1">&#39;Platform&#39;</span>: <span class="s1">&#39;Linux-4.4.0-130-generic-x86_64-with-debian-stretch-sid&#39;</span>, <span class="s1">&#39;Packages&#39;</span>: <span class="o">{</span><span class="s1">&#39;pytest&#39;</span>: <span class="s1">&#39;3.5.1&#39;</span>, <span class="s1">&#39;py&#39;</span>: <span class="s1">&#39;1.5.3&#39;</span>, <span class="s1">&#39;pluggy&#39;</span>: <span class="s1">&#39;0.6.0&#39;</span><span class="o">}</span>, <span class="s1">&#39;Plugins&#39;</span>: <span class="o">{</span><span class="s1">&#39;remotedata&#39;</span>: <span class="s1">&#39;0.2.1&#39;</span>, <span class="s1">&#39;openfiles&#39;</span>: <span class="s1">&#39;0.3.0&#39;</span>, <span class="s1">&#39;metadata&#39;</span>: <span class="s1">&#39;1.7.0&#39;</span>, <span class="s1">&#39;html&#39;</span>: <span class="s1">&#39;1.19.0&#39;</span>, <span class="s1">&#39;doctestplus&#39;</span>: <span class="s1">&#39;0.1.3&#39;</span>, <span class="s1">&#39;arraydiff&#39;</span>: <span class="s1">&#39;0.2&#39;</span><span class="o">}</span>, <span class="s1">&#39;JAVA_HOME&#39;</span>: <span class="s1">&#39;/usr/lib/jvm/java-8-oracle/jre/bin&#39;</span><span class="o">}</span>
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">50</span> items / <span class="m">47</span> deselected                                                                                                   

test_add.py::test_added_task_has_id_set PASSED                                                                                 <span class="o">[</span> <span class="m">33</span>%<span class="o">]</span>
test_api_exceptions.py::test_list_raises PASSED                                                                                <span class="o">[</span> <span class="m">66</span>%<span class="o">]</span>
test_api_exceptions.py::test_get_raises PASSED                                                                                 <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==============================================</span> <span class="m">3</span> passed, <span class="m">47</span> deselected in <span class="m">0</span>.07 <span class="nv">seconds</span> <span class="o">===============================================</span>
</pre></div>


<h3 id="_4">忽略测试</h3>
<p>test_unique_id_1.py</p>
<div class="highlight"><pre><span></span><span class="c1"># 技术支持 钉钉群：21745728(可以加钉钉pythontesting邀请加入) </span>
<span class="c1"># qq群：144081101 591302926  567351477</span>
<span class="sd">&quot;&quot;&quot;Test tasks.unique_id().&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">tasks</span>


<span class="k">def</span> <span class="nf">test_unique_id</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Calling unique_id() twice should return different numbers.&quot;&quot;&quot;</span>
    <span class="n">id_1</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">unique_id</span><span class="p">()</span>
    <span class="n">id_2</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">unique_id</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">id_1</span> <span class="o">!=</span> <span class="n">id_2</span>


<span class="nd">@pytest.fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">initialized_tasks_db</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Connect to db before testing, disconnect after.&quot;&quot;&quot;</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">start_tasks_db</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">),</span> <span class="s1">&#39;tiny&#39;</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">stop_tasks_db</span><span class="p">()</span>
</pre></div>


<p>执行：</p>
<div class="highlight"><pre><span></span>andrew@andrew-PowerEdge-T630:~/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests/func$ pytest test_unique_id_1.py 
<span class="o">============================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">1</span> item                                                                                                                             

test_unique_id_1.py F                                                                                                                  <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==================================================================</span> <span class="nv">FAILURES</span> <span class="o">==================================================================</span>
_______________________________________________________________ test_unique_id _______________________________________________________________

    def test_unique_id<span class="o">()</span>:
        <span class="s2">&quot;&quot;&quot;Calling unique_id() twice should return different numbers.&quot;&quot;&quot;</span>
        <span class="nv">id_1</span> <span class="o">=</span> tasks.unique_id<span class="o">()</span>
        <span class="nv">id_2</span> <span class="o">=</span> tasks.unique_id<span class="o">()</span>
&gt;       assert id_1 !<span class="o">=</span> id_2
E       assert <span class="m">1</span> !<span class="o">=</span> <span class="m">1</span>

test_unique_id_1.py:11: <span class="nv">AssertionError</span>
<span class="o">==========================================================</span> <span class="m">1</span> failed in <span class="m">0</span>.08 <span class="nv">seconds</span> <span class="o">==========================================================</span>
</pre></div>


<p>上述用例没有通过，我们现在想暂时不执行。</p>
<p>test_unique_id_2.py</p>
<div class="highlight"><pre><span></span><span class="c1"># 技术支持 钉钉群：21745728(可以加钉钉pythontesting邀请加入) </span>
<span class="c1"># qq群：144081101 591302926  567351477</span>
<span class="sd">&quot;&quot;&quot;Test tasks.unique_id().&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">tasks</span>
<span class="kn">from</span> <span class="nn">tasks</span> <span class="kn">import</span> <span class="n">Task</span>


<span class="nd">@pytest.mark.skip</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;misunderstood the API&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_unique_id_1</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Calling unique_id() twice should return different numbers.&quot;&quot;&quot;</span>
    <span class="n">id_1</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">unique_id</span><span class="p">()</span>
    <span class="n">id_2</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">unique_id</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">id_1</span> <span class="o">!=</span> <span class="n">id_2</span>


<span class="k">def</span> <span class="nf">test_unique_id_2</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;unique_id() should return an unused id.&quot;&quot;&quot;</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Task</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">)))</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Task</span><span class="p">(</span><span class="s1">&#39;two&#39;</span><span class="p">)))</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Task</span><span class="p">(</span><span class="s1">&#39;three&#39;</span><span class="p">)))</span>
    <span class="c1"># grab a unique id</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">unique_id</span><span class="p">()</span>
    <span class="c1"># make sure it isn&#39;t in the list of existing ids</span>
    <span class="k">assert</span> <span class="n">uid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ids</span>


<span class="nd">@pytest.fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">initialized_tasks_db</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Connect to db before testing, disconnect after.&quot;&quot;&quot;</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">start_tasks_db</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">),</span> <span class="s1">&#39;tiny&#39;</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">stop_tasks_db</span><span class="p">()</span>
</pre></div>


<p>执行：</p>
<div class="highlight"><pre><span></span>$ pytest test_unique_id_2.py 
<span class="o">============================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">2</span> items                                                                                                                            

test_unique_id_2.py s.                                                                                                                 <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">====================================================</span> <span class="m">1</span> passed, <span class="m">1</span> skipped in <span class="m">0</span>.03 <span class="nv">seconds</span> <span class="o">=====================================================</span>
</pre></div>


<p>skipif可以基于条件，比如基于版本号忽略用例。</p>
<p>test_unique_id_3.py</p>
<div class="highlight"><pre><span></span><span class="c1"># 技术支持 钉钉群：21745728(可以加钉钉pythontesting邀请加入) </span>
<span class="c1"># qq群：144081101 591302926  567351477</span>
<span class="sd">&quot;&quot;&quot;Test tasks.unique_id().&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">tasks</span>
<span class="kn">from</span> <span class="nn">tasks</span> <span class="kn">import</span> <span class="n">Task</span>


<span class="nd">@pytest.mark.skipif</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&lt;</span> <span class="s1">&#39;0.2.0&#39;</span><span class="p">,</span>
                    <span class="n">reason</span><span class="o">=</span><span class="s1">&#39;not supported until version 0.2.0&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_unique_id_1</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Calling unique_id() twice should return different numbers.&quot;&quot;&quot;</span>
    <span class="n">id_1</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">unique_id</span><span class="p">()</span>
    <span class="n">id_2</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">unique_id</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">id_1</span> <span class="o">!=</span> <span class="n">id_2</span>


<span class="k">def</span> <span class="nf">test_unique_id_2</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;unique_id() should return an unused id.&quot;&quot;&quot;</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Task</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">)))</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Task</span><span class="p">(</span><span class="s1">&#39;two&#39;</span><span class="p">)))</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Task</span><span class="p">(</span><span class="s1">&#39;three&#39;</span><span class="p">)))</span>
    <span class="c1"># grab a unique id</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">unique_id</span><span class="p">()</span>
    <span class="c1"># make sure it isn&#39;t in the list of existing ids</span>
    <span class="k">assert</span> <span class="n">uid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ids</span>


<span class="nd">@pytest.fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">initialized_tasks_db</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Connect to db before testing, disconnect after.&quot;&quot;&quot;</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">start_tasks_db</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">),</span> <span class="s1">&#39;tiny&#39;</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">stop_tasks_db</span><span class="p">()</span>
</pre></div>


<p>执行：</p>
<div class="highlight"><pre><span></span>andrew@andrew-PowerEdge-T630:~/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests/func$ pytest test_unique_id_3.py -v
<span class="o">============================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0 -- /usr/local/anaconda3/bin/python
cachedir: ../.pytest_cache
metadata: <span class="o">{</span><span class="s1">&#39;Python&#39;</span>: <span class="s1">&#39;3.6.5&#39;</span>, <span class="s1">&#39;Platform&#39;</span>: <span class="s1">&#39;Linux-4.4.0-130-generic-x86_64-with-debian-stretch-sid&#39;</span>, <span class="s1">&#39;Packages&#39;</span>: <span class="o">{</span><span class="s1">&#39;pytest&#39;</span>: <span class="s1">&#39;3.5.1&#39;</span>, <span class="s1">&#39;py&#39;</span>: <span class="s1">&#39;1.5.3&#39;</span>, <span class="s1">&#39;pluggy&#39;</span>: <span class="s1">&#39;0.6.0&#39;</span><span class="o">}</span>, <span class="s1">&#39;Plugins&#39;</span>: <span class="o">{</span><span class="s1">&#39;remotedata&#39;</span>: <span class="s1">&#39;0.2.1&#39;</span>, <span class="s1">&#39;openfiles&#39;</span>: <span class="s1">&#39;0.3.0&#39;</span>, <span class="s1">&#39;metadata&#39;</span>: <span class="s1">&#39;1.7.0&#39;</span>, <span class="s1">&#39;html&#39;</span>: <span class="s1">&#39;1.19.0&#39;</span>, <span class="s1">&#39;doctestplus&#39;</span>: <span class="s1">&#39;0.1.3&#39;</span>, <span class="s1">&#39;arraydiff&#39;</span>: <span class="s1">&#39;0.2&#39;</span><span class="o">}</span>, <span class="s1">&#39;JAVA_HOME&#39;</span>: <span class="s1">&#39;/usr/lib/jvm/java-8-oracle/jre/bin&#39;</span><span class="o">}</span>
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">2</span> items                                                                                                                            

test_unique_id_3.py::test_unique_id_1 SKIPPED                                                                                          <span class="o">[</span> <span class="m">50</span>%<span class="o">]</span>
test_unique_id_3.py::test_unique_id_2 PASSED                                                                                           <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">====================================================</span> <span class="m">1</span> passed, <span class="m">1</span> skipped in <span class="m">0</span>.03 <span class="nv">seconds</span> <span class="o">=====================================================</span>
andrew@andrew-PowerEdge-T630:~/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests/func$ pytest test_unique_id_3.py -rs
<span class="o">============================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">2</span> items                                                                                                                            

test_unique_id_3.py s.                                                                                                                 <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>
<span class="o">==========================================================</span> short <span class="nb">test</span> summary <span class="nv">info</span> <span class="o">===========================================================</span>
SKIP <span class="o">[</span><span class="m">1</span><span class="o">]</span> func/test_unique_id_3.py:8: not supported <span class="k">until</span> version <span class="m">0</span>.2.0

<span class="o">====================================================</span> <span class="m">1</span> passed, <span class="m">1</span> skipped in <span class="m">0</span>.03 <span class="nv">seconds</span> <span class="o">=====================================================</span>

$ ​​pytest​​ ​​--help​
​...​
-r chars
show extra <span class="nb">test</span> summary info as specified by chars
<span class="o">(</span>f<span class="o">)</span>ailed, <span class="o">(</span>E<span class="o">)</span>error, <span class="o">(</span>s<span class="o">)</span>skipped, <span class="o">(</span>x<span class="o">)</span>failed, <span class="o">(</span>X<span class="o">)</span>passed,
<span class="o">(</span>p<span class="o">)</span>passed, <span class="o">(</span>P<span class="o">)</span>passed with output, <span class="o">(</span>a<span class="o">)</span>all except pP.
​...​
</pre></div>


<h3 id="_5">预期失败</h3>
<p>上例中xfail可以标识在0.2.0失败，以上成功。</p>
<p>test_unique_id_4.py</p>
<div class="highlight"><pre><span></span><span class="c1"># 技术支持 钉钉群：21745728(可以加钉钉pythontesting邀请加入) </span>
<span class="c1"># qq群：144081101 591302926  567351477</span>
<span class="sd">&quot;&quot;&quot;Test tasks.unique_id().&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">tasks</span>
<span class="kn">from</span> <span class="nn">tasks</span> <span class="kn">import</span> <span class="n">Task</span>


<span class="nd">@pytest.mark.xfail</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&lt;</span> <span class="s1">&#39;0.2.0&#39;</span><span class="p">,</span>
                   <span class="n">reason</span><span class="o">=</span><span class="s1">&#39;not supported until version 0.2.0&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_unique_id_1</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Calling unique_id() twice should return different numbers.&quot;&quot;&quot;</span>
    <span class="n">id_1</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">unique_id</span><span class="p">()</span>
    <span class="n">id_2</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">unique_id</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">id_1</span> <span class="o">!=</span> <span class="n">id_2</span>


<span class="nd">@pytest.mark.xfail</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_unique_id_is_a_duck</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Demonstrate xfail.&quot;&quot;&quot;</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">unique_id</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">uid</span> <span class="o">==</span> <span class="s1">&#39;a duck&#39;</span>


<span class="nd">@pytest.mark.xfail</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_unique_id_not_a_duck</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Demonstrate xpass.&quot;&quot;&quot;</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">unique_id</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">uid</span> <span class="o">!=</span> <span class="s1">&#39;a duck&#39;</span>


<span class="k">def</span> <span class="nf">test_unique_id_2</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;unique_id() should return an unused id.&quot;&quot;&quot;</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Task</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">)))</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Task</span><span class="p">(</span><span class="s1">&#39;two&#39;</span><span class="p">)))</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Task</span><span class="p">(</span><span class="s1">&#39;three&#39;</span><span class="p">)))</span>
    <span class="c1"># grab a unique id</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">unique_id</span><span class="p">()</span>
    <span class="c1"># make sure it isn&#39;t in the list of existing ids</span>
    <span class="k">assert</span> <span class="n">uid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ids</span>


<span class="nd">@pytest.fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">initialized_tasks_db</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Connect to db before testing, disconnect after.&quot;&quot;&quot;</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">start_tasks_db</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">),</span> <span class="s1">&#39;tiny&#39;</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">stop_tasks_db</span><span class="p">()</span>
</pre></div>


<p>执行：</p>
<div class="highlight"><pre><span></span>c$ pytest test_unique_id_4.py
<span class="o">============================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">4</span> items                                                                                                                            

test_unique_id_4.py xxX.                                                                                                               <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">===============================================</span> <span class="m">1</span> passed, <span class="m">2</span> xfailed, <span class="m">1</span> xpassed in <span class="m">0</span>.10 <span class="nv">seconds</span> <span class="o">===============================================</span>
andrew@andrew-PowerEdge-T630:~/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests/func$ pytest test_unique_id_4.py -v
<span class="o">============================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0 -- /usr/local/anaconda3/bin/python
cachedir: ../.pytest_cache
metadata: <span class="o">{</span><span class="s1">&#39;Python&#39;</span>: <span class="s1">&#39;3.6.5&#39;</span>, <span class="s1">&#39;Platform&#39;</span>: <span class="s1">&#39;Linux-4.4.0-130-generic-x86_64-with-debian-stretch-sid&#39;</span>, <span class="s1">&#39;Packages&#39;</span>: <span class="o">{</span><span class="s1">&#39;pytest&#39;</span>: <span class="s1">&#39;3.5.1&#39;</span>, <span class="s1">&#39;py&#39;</span>: <span class="s1">&#39;1.5.3&#39;</span>, <span class="s1">&#39;pluggy&#39;</span>: <span class="s1">&#39;0.6.0&#39;</span><span class="o">}</span>, <span class="s1">&#39;Plugins&#39;</span>: <span class="o">{</span><span class="s1">&#39;remotedata&#39;</span>: <span class="s1">&#39;0.2.1&#39;</span>, <span class="s1">&#39;openfiles&#39;</span>: <span class="s1">&#39;0.3.0&#39;</span>, <span class="s1">&#39;metadata&#39;</span>: <span class="s1">&#39;1.7.0&#39;</span>, <span class="s1">&#39;html&#39;</span>: <span class="s1">&#39;1.19.0&#39;</span>, <span class="s1">&#39;doctestplus&#39;</span>: <span class="s1">&#39;0.1.3&#39;</span>, <span class="s1">&#39;arraydiff&#39;</span>: <span class="s1">&#39;0.2&#39;</span><span class="o">}</span>, <span class="s1">&#39;JAVA_HOME&#39;</span>: <span class="s1">&#39;/usr/lib/jvm/java-8-oracle/jre/bin&#39;</span><span class="o">}</span>
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">4</span> items                                                                                                                            

test_unique_id_4.py::test_unique_id_1 xfail                                                                                            <span class="o">[</span> <span class="m">25</span>%<span class="o">]</span>
test_unique_id_4.py::test_unique_id_is_a_duck xfail                                                                                    <span class="o">[</span> <span class="m">50</span>%<span class="o">]</span>
test_unique_id_4.py::test_unique_id_not_a_duck XPASS                                                                                   <span class="o">[</span> <span class="m">75</span>%<span class="o">]</span>
test_unique_id_4.py::test_unique_id_2 PASSED                                                                                           <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">===============================================</span> <span class="m">1</span> passed, <span class="m">2</span> xfailed, <span class="m">1</span> xpassed in <span class="m">0</span>.11 <span class="nv">seconds</span> <span class="o">===============================================</span>
</pre></div>


<p>在pytest.ini设置</p>
<div class="highlight"><pre><span></span><span class="o">[</span>pytest<span class="o">]</span>
<span class="nv">xfail_strict</span><span class="o">=</span><span class="nb">true</span>
</pre></div>


<p>xfail会置为FAIL。</p>
<h3 id="_6">批量执行</h3>
<ul>
<li>单个目录</li>
</ul>
<div class="highlight"><pre><span></span>andrew@andrew-PowerEdge-T630:~/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj$ pytest  tests/func --tb<span class="o">=</span><span class="nv">no</span>
<span class="o">============================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">50</span> items                                                                                                                           

tests/func/test_add.py ..                                                                                                              <span class="o">[</span>  <span class="m">4</span>%<span class="o">]</span>
tests/func/test_add_variety.py ................................                                                                        <span class="o">[</span> <span class="m">68</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py .......                                                                                              <span class="o">[</span> <span class="m">82</span>%<span class="o">]</span>
tests/func/test_unique_id_1.py F                                                                                                       <span class="o">[</span> <span class="m">84</span>%<span class="o">]</span>
tests/func/test_unique_id_2.py s.                                                                                                      <span class="o">[</span> <span class="m">88</span>%<span class="o">]</span>
tests/func/test_unique_id_3.py s.                                                                                                      <span class="o">[</span> <span class="m">92</span>%<span class="o">]</span>
tests/func/test_unique_id_4.py xxX.                                                                                                    <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">====================================</span> <span class="m">1</span> failed, <span class="m">44</span> passed, <span class="m">2</span> skipped, <span class="m">2</span> xfailed, <span class="m">1</span> xpassed in <span class="m">0</span>.31 <span class="nv">seconds</span> <span class="o">====================================</span>
andrew@andrew-PowerEdge-T630:~/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj$ pytest  tests/func --tb<span class="o">=</span>no -v
<span class="o">============================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0 -- /usr/local/anaconda3/bin/python
cachedir: tests/.pytest_cache
metadata: <span class="o">{</span><span class="s1">&#39;Python&#39;</span>: <span class="s1">&#39;3.6.5&#39;</span>, <span class="s1">&#39;Platform&#39;</span>: <span class="s1">&#39;Linux-4.4.0-130-generic-x86_64-with-debian-stretch-sid&#39;</span>, <span class="s1">&#39;Packages&#39;</span>: <span class="o">{</span><span class="s1">&#39;pytest&#39;</span>: <span class="s1">&#39;3.5.1&#39;</span>, <span class="s1">&#39;py&#39;</span>: <span class="s1">&#39;1.5.3&#39;</span>, <span class="s1">&#39;pluggy&#39;</span>: <span class="s1">&#39;0.6.0&#39;</span><span class="o">}</span>, <span class="s1">&#39;Plugins&#39;</span>: <span class="o">{</span><span class="s1">&#39;remotedata&#39;</span>: <span class="s1">&#39;0.2.1&#39;</span>, <span class="s1">&#39;openfiles&#39;</span>: <span class="s1">&#39;0.3.0&#39;</span>, <span class="s1">&#39;metadata&#39;</span>: <span class="s1">&#39;1.7.0&#39;</span>, <span class="s1">&#39;html&#39;</span>: <span class="s1">&#39;1.19.0&#39;</span>, <span class="s1">&#39;doctestplus&#39;</span>: <span class="s1">&#39;0.1.3&#39;</span>, <span class="s1">&#39;arraydiff&#39;</span>: <span class="s1">&#39;0.2&#39;</span><span class="o">}</span>, <span class="s1">&#39;JAVA_HOME&#39;</span>: <span class="s1">&#39;/usr/lib/jvm/java-8-oracle/jre/bin&#39;</span><span class="o">}</span>
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">50</span> items                                                                                                                           

tests/func/test_add.py::test_add_returns_valid_id PASSED                                                                               <span class="o">[</span>  <span class="m">2</span>%<span class="o">]</span>
tests/func/test_add.py::test_added_task_has_id_set PASSED                                                                              <span class="o">[</span>  <span class="m">4</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_1 PASSED                                                                                      <span class="o">[</span>  <span class="m">6</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_2<span class="o">[</span>task0<span class="o">]</span> PASSED                                                                               <span class="o">[</span>  <span class="m">8</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_2<span class="o">[</span>task1<span class="o">]</span> PASSED                                                                               <span class="o">[</span> <span class="m">10</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_2<span class="o">[</span>task2<span class="o">]</span> PASSED                                                                               <span class="o">[</span> <span class="m">12</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_2<span class="o">[</span>task3<span class="o">]</span> PASSED                                                                               <span class="o">[</span> <span class="m">14</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_3<span class="o">[</span>sleep-None-False<span class="o">]</span> PASSED                                                                    <span class="o">[</span> <span class="m">16</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_3<span class="o">[</span>wake-brian-False<span class="o">]</span> PASSED                                                                    <span class="o">[</span> <span class="m">18</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_3<span class="o">[</span>breathe-BRIAN-True<span class="o">]</span> PASSED                                                                  <span class="o">[</span> <span class="m">20</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_3<span class="o">[</span>eat eggs-BrIaN-False<span class="o">]</span> PASSED                                                                <span class="o">[</span> <span class="m">22</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_4<span class="o">[</span>task0<span class="o">]</span> PASSED                                                                               <span class="o">[</span> <span class="m">24</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_4<span class="o">[</span>task1<span class="o">]</span> PASSED                                                                               <span class="o">[</span> <span class="m">26</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_4<span class="o">[</span>task2<span class="o">]</span> PASSED                                                                               <span class="o">[</span> <span class="m">28</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_4<span class="o">[</span>task3<span class="o">]</span> PASSED                                                                               <span class="o">[</span> <span class="m">30</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_4<span class="o">[</span>task4<span class="o">]</span> PASSED                                                                               <span class="o">[</span> <span class="m">32</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_5<span class="o">[</span>Task<span class="o">(</span>sleep,None,True<span class="o">)]</span> PASSED                                                               <span class="o">[</span> <span class="m">34</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_5<span class="o">[</span>Task<span class="o">(</span>wake,brian,False<span class="o">)</span><span class="m">0</span><span class="o">]</span> PASSED                                                             <span class="o">[</span> <span class="m">36</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_5<span class="o">[</span>Task<span class="o">(</span>wake,brian,False<span class="o">)</span><span class="m">1</span><span class="o">]</span> PASSED                                                             <span class="o">[</span> <span class="m">38</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_5<span class="o">[</span>Task<span class="o">(</span>breathe,BRIAN,True<span class="o">)]</span> PASSED                                                            <span class="o">[</span> <span class="m">40</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_5<span class="o">[</span>Task<span class="o">(</span>exercise,BrIaN,False<span class="o">)]</span> PASSED                                                          <span class="o">[</span> <span class="m">42</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_6<span class="o">[</span>just summary<span class="o">]</span> PASSED                                                                        <span class="o">[</span> <span class="m">44</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_6<span class="o">[</span>summary/owner<span class="o">]</span> PASSED                                                                       <span class="o">[</span> <span class="m">46</span>%<span class="o">]</span>
tests/func/test_add_variety.py::test_add_6<span class="o">[</span>summary/owner/done<span class="o">]</span> PASSED                                                                  <span class="o">[</span> <span class="m">48</span>%<span class="o">]</span>
tests/func/test_add_variety.py::TestAdd::test_equivalent<span class="o">[</span>Task<span class="o">(</span>sleep,None,True<span class="o">)]</span> PASSED                                                 <span class="o">[</span> <span class="m">50</span>%<span class="o">]</span>
tests/func/test_add_variety.py::TestAdd::test_equivalent<span class="o">[</span>Task<span class="o">(</span>wake,brian,False<span class="o">)</span><span class="m">0</span><span class="o">]</span> PASSED                                               <span class="o">[</span> <span class="m">52</span>%<span class="o">]</span>
tests/func/test_add_variety.py::TestAdd::test_equivalent<span class="o">[</span>Task<span class="o">(</span>wake,brian,False<span class="o">)</span><span class="m">1</span><span class="o">]</span> PASSED                                               <span class="o">[</span> <span class="m">54</span>%<span class="o">]</span>
tests/func/test_add_variety.py::TestAdd::test_equivalent<span class="o">[</span>Task<span class="o">(</span>breathe,BRIAN,True<span class="o">)]</span> PASSED                                              <span class="o">[</span> <span class="m">56</span>%<span class="o">]</span>
tests/func/test_add_variety.py::TestAdd::test_equivalent<span class="o">[</span>Task<span class="o">(</span>exercise,BrIaN,False<span class="o">)]</span> PASSED                                            <span class="o">[</span> <span class="m">58</span>%<span class="o">]</span>
tests/func/test_add_variety.py::TestAdd::test_valid_id<span class="o">[</span>Task<span class="o">(</span>sleep,None,True<span class="o">)]</span> PASSED                                                   <span class="o">[</span> <span class="m">60</span>%<span class="o">]</span>
tests/func/test_add_variety.py::TestAdd::test_valid_id<span class="o">[</span>Task<span class="o">(</span>wake,brian,False<span class="o">)</span><span class="m">0</span><span class="o">]</span> PASSED                                                 <span class="o">[</span> <span class="m">62</span>%<span class="o">]</span>
tests/func/test_add_variety.py::TestAdd::test_valid_id<span class="o">[</span>Task<span class="o">(</span>wake,brian,False<span class="o">)</span><span class="m">1</span><span class="o">]</span> PASSED                                                 <span class="o">[</span> <span class="m">64</span>%<span class="o">]</span>
tests/func/test_add_variety.py::TestAdd::test_valid_id<span class="o">[</span>Task<span class="o">(</span>breathe,BRIAN,True<span class="o">)]</span> PASSED                                                <span class="o">[</span> <span class="m">66</span>%<span class="o">]</span>
tests/func/test_add_variety.py::TestAdd::test_valid_id<span class="o">[</span>Task<span class="o">(</span>exercise,BrIaN,False<span class="o">)]</span> PASSED                                              <span class="o">[</span> <span class="m">68</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py::test_add_raises PASSED                                                                              <span class="o">[</span> <span class="m">70</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py::test_list_raises PASSED                                                                             <span class="o">[</span> <span class="m">72</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py::test_get_raises PASSED                                                                              <span class="o">[</span> <span class="m">74</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py::TestUpdate::test_bad_id PASSED                                                                      <span class="o">[</span> <span class="m">76</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py::TestUpdate::test_bad_task PASSED                                                                    <span class="o">[</span> <span class="m">78</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py::test_delete_raises PASSED                                                                           <span class="o">[</span> <span class="m">80</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py::test_start_tasks_db_raises PASSED                                                                   <span class="o">[</span> <span class="m">82</span>%<span class="o">]</span>
tests/func/test_unique_id_1.py::test_unique_id FAILED                                                                                  <span class="o">[</span> <span class="m">84</span>%<span class="o">]</span>
tests/func/test_unique_id_2.py::test_unique_id_1 SKIPPED                                                                               <span class="o">[</span> <span class="m">86</span>%<span class="o">]</span>
tests/func/test_unique_id_2.py::test_unique_id_2 PASSED                                                                                <span class="o">[</span> <span class="m">88</span>%<span class="o">]</span>
tests/func/test_unique_id_3.py::test_unique_id_1 SKIPPED                                                                               <span class="o">[</span> <span class="m">90</span>%<span class="o">]</span>
tests/func/test_unique_id_3.py::test_unique_id_2 PASSED                                                                                <span class="o">[</span> <span class="m">92</span>%<span class="o">]</span>
tests/func/test_unique_id_4.py::test_unique_id_1 xfail                                                                                 <span class="o">[</span> <span class="m">94</span>%<span class="o">]</span>
tests/func/test_unique_id_4.py::test_unique_id_is_a_duck xfail                                                                         <span class="o">[</span> <span class="m">96</span>%<span class="o">]</span>
tests/func/test_unique_id_4.py::test_unique_id_not_a_duck XPASS                                                                        <span class="o">[</span> <span class="m">98</span>%<span class="o">]</span>
tests/func/test_unique_id_4.py::test_unique_id_2 PASSED                                                                                <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">====================================</span> <span class="m">1</span> failed, <span class="m">44</span> passed, <span class="m">2</span> skipped, <span class="m">2</span> xfailed, <span class="m">1</span> xpassed in <span class="m">0</span>.34 <span class="nv">seconds</span> <span class="o">====================================</span>
</pre></div>


<ul>
<li>单个文件/模块</li>
</ul>
<div class="highlight"><pre><span></span>andrew@andrew-PowerEdge-T630:~/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj$ pytest tests/func/test_add.py 
<span class="o">============================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">2</span> items                                                                                                                            

tests/func/test_add.py ..                                                                                                              <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>
</pre></div>


<ul>
<li>单个函数</li>
</ul>
<div class="highlight"><pre><span></span>$ pytest tests/func/test_add.py::test_add_returns_valid_id -v
<span class="o">============================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0 -- /usr/local/anaconda3/bin/python
cachedir: tests/.pytest_cache
metadata: <span class="o">{</span><span class="s1">&#39;Python&#39;</span>: <span class="s1">&#39;3.6.5&#39;</span>, <span class="s1">&#39;Platform&#39;</span>: <span class="s1">&#39;Linux-4.4.0-130-generic-x86_64-with-debian-stretch-sid&#39;</span>, <span class="s1">&#39;Packages&#39;</span>: <span class="o">{</span><span class="s1">&#39;pytest&#39;</span>: <span class="s1">&#39;3.5.1&#39;</span>, <span class="s1">&#39;py&#39;</span>: <span class="s1">&#39;1.5.3&#39;</span>, <span class="s1">&#39;pluggy&#39;</span>: <span class="s1">&#39;0.6.0&#39;</span><span class="o">}</span>, <span class="s1">&#39;Plugins&#39;</span>: <span class="o">{</span><span class="s1">&#39;remotedata&#39;</span>: <span class="s1">&#39;0.2.1&#39;</span>, <span class="s1">&#39;openfiles&#39;</span>: <span class="s1">&#39;0.3.0&#39;</span>, <span class="s1">&#39;metadata&#39;</span>: <span class="s1">&#39;1.7.0&#39;</span>, <span class="s1">&#39;html&#39;</span>: <span class="s1">&#39;1.19.0&#39;</span>, <span class="s1">&#39;doctestplus&#39;</span>: <span class="s1">&#39;0.1.3&#39;</span>, <span class="s1">&#39;arraydiff&#39;</span>: <span class="s1">&#39;0.2&#39;</span><span class="o">}</span>, <span class="s1">&#39;JAVA_HOME&#39;</span>: <span class="s1">&#39;/usr/lib/jvm/java-8-oracle/jre/bin&#39;</span><span class="o">}</span>
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">1</span> item                                                                                                                             

tests/func/test_add.py::test_add_returns_valid_id PASSED                                                                               <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==========================================================</span> <span class="m">1</span> passed in <span class="m">0</span>.03 <span class="nv">seconds</span> <span class="o">==========================================================</span>
                                                                                                            <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>
</pre></div>


<ul>
<li>单个类</li>
</ul>
<div class="highlight"><pre><span></span>$ pytest tests/func/test_api_exceptions.py::TestUpdate
<span class="o">============================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">2</span> items                                                                                                                            

tests/func/test_api_exceptions.py ..                                                                                                   <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==========================================================</span> <span class="m">2</span> passed in <span class="m">0</span>.01 <span class="nv">seconds</span> <span class="o">==========================================================</span>
</pre></div>


<ul>
<li>单个类的测试方法</li>
</ul>
<div class="highlight"><pre><span></span>andrew@andrew-PowerEdge-T630:~/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj$ pytest tests/func/test_api_exceptions.py::TestUpdate::test_bad_id
<span class="o">============================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj/tests, inifile: pytest.ini
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">1</span> item                                                                                                                             

tests/func/test_api_exceptions.py .                                                                                                    <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==========================================================</span> <span class="m">1</span> passed in <span class="m">0</span>.01 <span class="nv">seconds</span> <span class="o">==========================================================</span>
</pre></div>


<ul>
<li>基于测试名</li>
</ul>
<div class="highlight"><pre><span></span>$ pytest -v -k <span class="nv">_raises</span>
<span class="o">============================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0 -- /usr/local/anaconda3/bin/python
cachedir: .pytest_cache
metadata: <span class="o">{</span><span class="s1">&#39;Python&#39;</span>: <span class="s1">&#39;3.6.5&#39;</span>, <span class="s1">&#39;Platform&#39;</span>: <span class="s1">&#39;Linux-4.4.0-130-generic-x86_64-with-debian-stretch-sid&#39;</span>, <span class="s1">&#39;Packages&#39;</span>: <span class="o">{</span><span class="s1">&#39;pytest&#39;</span>: <span class="s1">&#39;3.5.1&#39;</span>, <span class="s1">&#39;py&#39;</span>: <span class="s1">&#39;1.5.3&#39;</span>, <span class="s1">&#39;pluggy&#39;</span>: <span class="s1">&#39;0.6.0&#39;</span><span class="o">}</span>, <span class="s1">&#39;Plugins&#39;</span>: <span class="o">{</span><span class="s1">&#39;remotedata&#39;</span>: <span class="s1">&#39;0.2.1&#39;</span>, <span class="s1">&#39;openfiles&#39;</span>: <span class="s1">&#39;0.3.0&#39;</span>, <span class="s1">&#39;metadata&#39;</span>: <span class="s1">&#39;1.7.0&#39;</span>, <span class="s1">&#39;html&#39;</span>: <span class="s1">&#39;1.19.0&#39;</span>, <span class="s1">&#39;doctestplus&#39;</span>: <span class="s1">&#39;0.1.3&#39;</span>, <span class="s1">&#39;arraydiff&#39;</span>: <span class="s1">&#39;0.2&#39;</span><span class="o">}</span>, <span class="s1">&#39;JAVA_HOME&#39;</span>: <span class="s1">&#39;/usr/lib/jvm/java-8-oracle/jre/bin&#39;</span><span class="o">}</span>
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj, inifile:
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">56</span> items / <span class="m">51</span> deselected                                                                                                           

tests/func/test_api_exceptions.py::test_add_raises PASSED                                                                              <span class="o">[</span> <span class="m">20</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py::test_list_raises PASSED                                                                             <span class="o">[</span> <span class="m">40</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py::test_get_raises PASSED                                                                              <span class="o">[</span> <span class="m">60</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py::test_delete_raises PASSED                                                                           <span class="o">[</span> <span class="m">80</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py::test_start_tasks_db_raises PASSED                                                                   <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==================================================</span> <span class="m">5</span> passed, <span class="m">51</span> deselected in <span class="m">0</span>.12 <span class="nv">seconds</span> <span class="o">===================================================</span>
andrew@andrew-PowerEdge-T630:~/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj$ pytest -v -k <span class="s2">&quot;_raises and not delete&quot;</span>
<span class="o">============================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================================================</span>
platform linux -- Python <span class="m">3</span>.6.5, pytest-3.5.1, py-1.5.3, pluggy-0.6.0 -- /usr/local/anaconda3/bin/python
cachedir: .pytest_cache
metadata: <span class="o">{</span><span class="s1">&#39;Python&#39;</span>: <span class="s1">&#39;3.6.5&#39;</span>, <span class="s1">&#39;Platform&#39;</span>: <span class="s1">&#39;Linux-4.4.0-130-generic-x86_64-with-debian-stretch-sid&#39;</span>, <span class="s1">&#39;Packages&#39;</span>: <span class="o">{</span><span class="s1">&#39;pytest&#39;</span>: <span class="s1">&#39;3.5.1&#39;</span>, <span class="s1">&#39;py&#39;</span>: <span class="s1">&#39;1.5.3&#39;</span>, <span class="s1">&#39;pluggy&#39;</span>: <span class="s1">&#39;0.6.0&#39;</span><span class="o">}</span>, <span class="s1">&#39;Plugins&#39;</span>: <span class="o">{</span><span class="s1">&#39;remotedata&#39;</span>: <span class="s1">&#39;0.2.1&#39;</span>, <span class="s1">&#39;openfiles&#39;</span>: <span class="s1">&#39;0.3.0&#39;</span>, <span class="s1">&#39;metadata&#39;</span>: <span class="s1">&#39;1.7.0&#39;</span>, <span class="s1">&#39;html&#39;</span>: <span class="s1">&#39;1.19.0&#39;</span>, <span class="s1">&#39;doctestplus&#39;</span>: <span class="s1">&#39;0.1.3&#39;</span>, <span class="s1">&#39;arraydiff&#39;</span>: <span class="s1">&#39;0.2&#39;</span><span class="o">}</span>, <span class="s1">&#39;JAVA_HOME&#39;</span>: <span class="s1">&#39;/usr/lib/jvm/java-8-oracle/jre/bin&#39;</span><span class="o">}</span>
rootdir: /home/andrew/code/python-api-tesing/python3_libraries/pytest_testing/ch2/tasks_proj, inifile:
plugins: remotedata-0.2.1, openfiles-0.3.0, metadata-1.7.0, html-1.19.0, doctestplus-0.1.3, arraydiff-0.2
collected <span class="m">56</span> items / <span class="m">52</span> deselected                                                                                                           

tests/func/test_api_exceptions.py::test_add_raises PASSED                                                                              <span class="o">[</span> <span class="m">25</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py::test_list_raises PASSED                                                                             <span class="o">[</span> <span class="m">50</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py::test_get_raises PASSED                                                                              <span class="o">[</span> <span class="m">75</span>%<span class="o">]</span>
tests/func/test_api_exceptions.py::test_start_tasks_db_raises PASSED                                                                   <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==================================================</span> <span class="m">4</span> passed, <span class="m">52</span> deselected in <span class="m">0</span>.06 <span class="nv">seconds</span> <span class="o">===================================================</span>
</pre></div>


<p>## 参考资料</p>
<ul>
<li><a href="https://china-testing.github.io/python_pytest_testing2.html">本文最新版本地址</a></li>
<li><a href="https://github.com/china-testing/python-api-tesing/tree/master/python3_libraries/pytest_testing">本文源码地址</a></li>
<li><a href="https://github.com/china-testing/python-api-tesing">本文涉及的python测试开发库</a> 谢谢点赞！</li>
<li><a href="https://github.com/china-testing/python-api-tesing/blob/master/books.md">本文相关海量书籍下载</a></li>
<li>python测试等IT技术支持qq群： 144081101(后期会录制视频存在该群群文件) 591302926 567351477 钉钉免费群：21745728</li>
<li>道家技术-手相手诊看相中医等钉钉群21734177 qq群：391441566 184175668 338228106 看手相、面相、舌相、抽签、体质识别。服务费50元每人次起。请联系钉钉或者微信pythontesting</li>
<li><a href="https://china-testing.github.io/testing_training.html">接口自动化性能测试线上培训大纲</a></li>
</ul>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://china-testing.github.io/testing_training.html">自动化性能接口测试线上及深圳培训与项目实战 qq群：144081101 591302926</a></li>
                            <li><a href="http://blog.sciencenet.cn/blog-2604609-1112306.html">pandas数据分析scrapy爬虫 521070358 Py人工智能pandas-opencv 6089740</a></li>
                            <li><a href="http://blog.sciencenet.cn/blog-2604609-1112306.html">中医解梦看相八字算命qq群 391441566 csdn书籍下载-python爬虫 437355848</a></li>
                        </ul>
                </div><!-- /.blogroll -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>